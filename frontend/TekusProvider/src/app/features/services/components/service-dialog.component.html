<h2 mat-dialog-title>
  <mat-icon>add</mat-icon>
  <span>Nuevo Servicio</span>
</h2>

<mat-dialog-content>
  <form [formGroup]="serviceForm" class="service-form">
    <div class="provider-info">
      <mat-icon>business</mat-icon>
      <span>Proveedor: <strong>{{ data.providerName }}</strong></span>
    </div>

    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Nombre del Servicio</mat-label>
      <input
        matInput
        formControlName="name"
        placeholder="Ej: Desarrollo Web Frontend"
      />
      <mat-icon matPrefix>room_service</mat-icon>
      @if (serviceForm.get('name')?.invalid && serviceForm.get('name')?.touched) {
        <mat-error>{{ getErrorMessage('name') }}</mat-error>
      }
    </mat-form-field>

    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Tarifa por Hora</mat-label>
      <input
        matInput
        type="number"
        formControlName="hourlyRate"
        placeholder="0.00"
        step="0.01"
        min="0.01"
      />
      <mat-icon matPrefix>attach_money</mat-icon>
      <span matTextPrefix>$&nbsp;</span>
      @if (serviceForm.get('hourlyRate')?.invalid && serviceForm.get('hourlyRate')?.touched) {
        <mat-error>{{ getErrorMessage('hourlyRate') }}</mat-error>
      }
    </mat-form-field>

    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Descripción</mat-label>
      <textarea
        matInput
        formControlName="description"
        placeholder="Describe el servicio que ofrece el proveedor"
        rows="4"
      ></textarea>
      <mat-icon matPrefix>description</mat-icon>
      @if (serviceForm.get('description')?.invalid && serviceForm.get('description')?.touched) {
        <mat-error>{{ getErrorMessage('description') }}</mat-error>
      }
    </mat-form-field>

    <div class="countries-section">
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Países donde se ofrece el servicio</mat-label>
        <input
          matInput
          formControlName="countrySearch"
          placeholder="Buscar país..."
          (input)="filterCountries($any($event.target).value)"
          [matAutocomplete]="auto"
        />
        <mat-icon matPrefix>public</mat-icon>
        <mat-autocomplete #auto="matAutocomplete" (optionSelected)="addCountry($event.option.value)">
          @for (country of filteredCountries(); track country.code) {
            <mat-option [value]="country.code" [disabled]="selectedCountryCodes.includes(country.code)">
              <div class="country-option">
                <span class="country-code">{{ country.code }}</span>
                <span class="country-name">{{ country.name }}</span>
              </div>
            </mat-option>
          }
        </mat-autocomplete>
        <mat-hint>Busque y seleccione los países donde se ofrece este servicio</mat-hint>
      </mat-form-field>

      @if (selectedCountryCodes.length > 0) {
        <div class="selected-countries">
          <p class="selected-label">Países seleccionados:</p>
          <div class="chips-container">
            @for (code of selectedCountryCodes; track code) {
              <mat-chip (removed)="removeCountry(code)">
                {{ getCountryName(code) }}
                <button matChipRemove>
                  <mat-icon>cancel</mat-icon>
                </button>
              </mat-chip>
            }
          </div>
        </div>
      } @else {
        <div class="no-countries-hint">
          <mat-icon>info</mat-icon>
          <span>No se han seleccionado países. El servicio será global.</span>
        </div>
      }
    </div>
  </form>
</mat-dialog-content>

<mat-dialog-actions align="end">
  <button mat-button (click)="onCancel()">
    <mat-icon>close</mat-icon>
    Cancelar
  </button>
  <button
    mat-raised-button
    color="primary"
    (click)="onSubmit()"
    [disabled]="serviceForm.invalid"
  >
    <mat-icon>add</mat-icon>
    Crear Servicio
  </button>
</mat-dialog-actions>

